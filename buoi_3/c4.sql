-- Example:
-- 123-5678
-- CHARINDEX=4
-- LEN=8
-- Substring 1, 3(=4-1)
-- Substring 5(=4+1), 4=(8-4)

ALTER TABLE TRANDAU
DROP CONSTRAINT IF EXISTS KETQUACONSTRAINT

ALTER TABLE TRANDAU
ADD CONSTRAINT KETQUACONSTRAINT CHECK (
    CHARINDEX('-', KETQUA) != 0
    AND TRY_CAST(SUBSTRING(KETQUA, 1, CHARINDEX('-', KETQUA)-1) AS INTEGER) IS NOT NULL
    AND TRY_CAST(SUBSTRING(KETQUA, CHARINDEX('-', KETQUA)+1, LEN(KETQUA)-CHARINDEX('-', KETQUA)) AS INTEGER) IS NOT NULL
)

-- hiện error = đúng
-- The INSERT statement conflicted with the CHECK constraint "KETQUACONSTRAINT". The conflict occurred in database "QLBongDa", table "dbo.TRANDAU", column 'KETQUA'.
INSERT INTO TRANDAU
VALUES (2010, 8, '12/29/2010', 'KKH', 'HAGL', 'NT', '31')

INSERT INTO TRANDAU
VALUES (2010, 8, '12/29/2010', 'KKH', 'HAGL', 'NT', 'A-1')

-- test
INSERT INTO TRANDAU
VALUES
    (2010, 8, '12/20/2010', 'KKH', 'HAGL', 'NT', '123-5'),
    (2010, 8, '12/21/2010', 'KKH', 'HAGL', 'NT', '12-45'),
    (2010, 8, '12/22/2010', 'KKH', 'HAGL', 'NT', '1-345'),
    (2010, 8, '12/23/2010', 'KKH', 'HAGL', 'NT', '0-10'),
    (2010, 8, '12/24/2010', 'KKH', 'HAGL', 'NT', '7-0'),
    (2010, 8, '12/25/2010', 'KKH', 'HAGL', 'NT', '7-10')

SELECT KETQUA,
    TRY_CAST(SUBSTRING(KETQUA, 1, CHARINDEX('-', KETQUA)-1) AS INTEGER) KQ1,
    TRY_CAST(SUBSTRING(KETQUA, CHARINDEX('-', KETQUA)+1, LEN(KETQUA)-CHARINDEX('-', KETQUA)) AS INTEGER) KQ2
FROM TRANDAU

DELETE FROM TRANDAU
WHERE NAM=2010